name: Attendance Reminders

on:
  schedule:
    # 10 & 5 min before MSP/MOP1 cap 07:20 IST -> 01:40 / 01:45 UTC
    - cron: "40 1 * * *"
    - cron: "45 1 * * *"
    # MHCP-1 cap 15:35 IST -> 09:55 / 10:00 UTC
    - cron: "55 9 * * *"
    - cron: "0 10 * * *"
    # MHP & MOP2 cap 15:45 IST -> 10:05 / 10:10 UTC
    - cron: "5 10 * * *"
    - cron: "10 10 * * *"
    # MHCP-2 cap 18:00 IST -> 12:20 / 12:25 UTC
    - cron: "20 12 * * *"
    - cron: "25 12 * * *"

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    steps:
      - name: Call preCapReminder for all capped programs
        env:
          API_BASE: https://meedianai-flow-v2.vercel.app
          TOKEN: GOTHERENOWOHMEN
        run: |
          PROGRAMS="MSP MOP1 MHCP-1 MHCP-2 MHP MOP2"
          for p in $PROGRAMS; do
            echo "Reminder for $p"
            curl -s -X POST "$API_BASE/api/attendance?section=preCapReminder" \
              -H "Content-Type: application/json" \
              -H "Authorization: Bearer ${TOKEN}" \
              -d "{\"programKey\":\"$p\"}" || true
          done
